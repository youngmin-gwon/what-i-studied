---
title: kernel
tags: [kernel, linux, operating-systems, os]
aliases: [OS ì»¤ë„, ìš´ì˜ì²´ì œ ì»¤ë„, ì»¤ë„]
date modified: 2025-12-18 10:05:18 +09:00
date created: 2025-12-16 21:01:14 +09:00
---

## ì»¤ë„ (Kernel) ì´ë€ ë¬´ì—‡ì¸ê°€

ì»¤ë„ì€ ìš´ì˜ì²´ì œì˜ í•µì‹¬ ë¶€ë¶„ìœ¼ë¡œ, í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì—°ê²°í•˜ëŠ” ê³„ì¸µì´ë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ë“¤ì´ í•˜ë“œì›¨ì–´ ìì› (CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬ ë“±) ì„ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ ì¤‘ì¬í•˜ê³  ê´€ë¦¬í•œë‹¤.

### ì»¤ë„ì´ í•„ìš”í•˜ê²Œ ëœ ì—­ì‚¬ì  ë°°ê²½

ì´ˆê¸° ì»´í“¨í„° (1940~1950 ë…„ëŒ€) ëŠ” í•œ ë²ˆì— í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨ë§Œ ì‹¤í–‰í–ˆë‹¤. í”„ë¡œê·¸ë¨ì´ í•˜ë“œì›¨ì–´ë¥¼ ì§ì ‘ ì œì–´í–ˆê³ , í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë˜ë©´ ë‹¤ìŒ í”„ë¡œê·¸ë¨ì„ ë¡œë“œí–ˆë‹¤. ì´ ë°©ì‹ì€ ë‹¨ìˆœí–ˆì§€ë§Œ ëª‡ ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆë‹¤:

1. **ìì› ë‚­ë¹„**: CPU ê°€ I/O ì‘ì—… (ë””ìŠ¤í¬ ì½ê¸° ë“±) ì„ ê¸°ë‹¤ë¦¬ëŠ” ë™ì•ˆ ìœ íœ´ ìƒíƒœë¡œ ìˆì—ˆë‹¤.
2. **ì•ˆì „ì„± ë¶€ì¡±**: í”„ë¡œê·¸ë¨ì˜ ë²„ê·¸ê°€ ì „ì²´ ì‹œìŠ¤í…œì„ ë©ˆì¶”ê²Œ í•  ìˆ˜ ìˆì—ˆë‹¤.
3. **ë¹„íš¨ìœ¨ì„±**: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì»´í“¨í„°ë¥¼ ê³µìœ í•˜ë ¤ë©´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì°¨ë¡€ë¥¼ ê¸°ë‹¤ë ¤ì•¼ í–ˆë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **ë©€í‹°í”„ë¡œê·¸ë˜ë°** ê³¼ **ì‹œë¶„í•  (time-sharing)** ê°œë…ì´ ë“±ì¥í–ˆë‹¤ (1960 ë…„ëŒ€). ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì„ ë©”ëª¨ë¦¬ì— ë™ì‹œì— ë¡œë“œí•˜ê³ , CPU ì‹œê°„ì„ ë¹ ë¥´ê²Œ ë‚˜ëˆ ì£¼ë©´ì„œ ë§ˆì¹˜ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ê²Œ í–ˆë‹¤. ì´ë•Œ **í”„ë¡œê·¸ë¨ë“¤ ê°„ì˜ ì¤‘ì¬ì ì—­í• ** ì´ í•„ìš”í–ˆê³ , ì´ê²ƒì´ ì»¤ë„ì˜ ì‹œì‘ì´ë‹¤.

### ì»¤ë„ì˜ í•µì‹¬ ì—­í• 

#### 1. í”„ë¡œì„¸ìŠ¤ ìŠ¤ì¼€ì¤„ë§

ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ê°€ ë™ì‹œì— ì‹¤í–‰ë˜ë ¤ë©´ CPU ë¥¼ ê³µì •í•˜ê²Œ ë‚˜ëˆ ì•¼ í•œë‹¤. 1960 ë…„ëŒ€ **Multics** ì‹œìŠ¤í…œì—ì„œ ì²˜ìŒ êµ¬í˜„ëœ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ê° í”„ë¡œì„¸ìŠ¤ì— íƒ€ì„ìŠ¬ë¼ì´ìŠ¤ (time slice) ë¥¼ í• ë‹¹í–ˆë‹¤. í˜„ëŒ€ ë¦¬ëˆ…ìŠ¤ì˜ **CFS(Completely Fair Scheduler)** ëŠ” ì´ë¥¼ ë°œì „ì‹œì¼œ, ëª¨ë“  í”„ë¡œì„¸ìŠ¤ê°€ "ê³µì •í•œ" CPU ì‹œê°„ì„ ë°›ë„ë¡ ë³´ì¥í•œë‹¤.

```mermaid
graph TD
    A[í”„ë¡œì„¸ìŠ¤ A] -->|ì‹¤í–‰ 3ms| CPU
    B[í”„ë¡œì„¸ìŠ¤ B] -->|ì‹¤í–‰ 3ms| CPU
    C[í”„ë¡œì„¸ìŠ¤ C] -->|ì‹¤í–‰ 3ms| CPU
    CPU -->|íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸| Scheduler[ìŠ¤ì¼€ì¤„ëŸ¬]
    Scheduler -->|ë‹¤ìŒ í”„ë¡œì„¸ìŠ¤ ì„ íƒ| A
```

**ì™œ ì´ë ‡ê²Œ ì„¤ê³„ë˜ì—ˆë‚˜?**

ì´ˆê¸° ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ë‹¨ìˆœ ë¼ìš´ë“œë¡œë¹ˆ ë°©ì‹ì´ì—ˆì§€ë§Œ, ì´ëŠ” CPU ì§‘ì•½ì  ì‘ì—…ê³¼ I/O ì§‘ì•½ì  ì‘ì—…ì„ êµ¬ë¶„í•˜ì§€ ëª»í–ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ìŠ¤íŠ¸ ì—ë””í„°ëŠ” ì‚¬ìš©ì ì…ë ¥ì„ ê¸°ë‹¤ë¦¬ëŠ” ì‹œê°„ì´ ë§ì•„ CPU ë¥¼ ê±°ì˜ ì“°ì§€ ì•Šì§€ë§Œ, ë¹ ë¥¸ ì‘ë‹µì„±ì´ í•„ìš”í•˜ë‹¤. ë°˜ë©´ ë™ì˜ìƒ ì¸ì½”ë”©ì€ CPU ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤. CFS ëŠ” ê° í”„ë¡œì„¸ìŠ¤ì˜ ì‹¤ì œ ì‹¤í–‰ ì‹œê°„ (vruntime) ì„ ì¶”ì í•´, ëœ ì‹¤í–‰ëœ í”„ë¡œì„¸ìŠ¤ì— ìš°ì„ ê¶Œì„ ì¤€ë‹¤.

#### 2. ë©”ëª¨ë¦¬ ê´€ë¦¬

ì´ˆê¸° ë©€í‹°í”„ë¡œê·¸ë˜ë° ì‹œìŠ¤í…œì—ì„œëŠ” ë©”ëª¨ë¦¬ë¥¼ ê³ ì • í¬ê¸°ë¡œ ë‚˜ëˆ´ë‹¤ (partition). í•˜ì§€ë§Œ í”„ë¡œê·¸ë¨ í¬ê¸°ê°€ ë‹¤ì–‘í•´ì§€ë©´ì„œ ë©”ëª¨ë¦¬ ë‚­ë¹„ê°€ ì‹¬í–ˆë‹¤.

1960 ë…„ëŒ€ ë§ **[[virtual-memory|ê°€ìƒ ë©”ëª¨ë¦¬]](Virtual Memory)** ê°œë…ì´ ë“±ì¥í–ˆë‹¤. ê° í”„ë¡œê·¸ë¨ì€ ìì‹ ë§Œì˜ ë…ë¦½ëœ ì£¼ì†Œ ê³µê°„ì„ ê°€ì§€ê³ , ì‹¤ì œ ë¬¼ë¦¬ ë©”ëª¨ë¦¬ëŠ” ìš´ì˜ì²´ì œê°€ ìˆ¨ê²¨ì„œ ê´€ë¦¬í•œë‹¤. ì´ë¥¼ í†µí•´:

- **ë©”ëª¨ë¦¬ ê²©ë¦¬**: í”„ë¡œê·¸ë¨ A ê°€ í”„ë¡œê·¸ë¨ B ì˜ ë©”ëª¨ë¦¬ë¥¼ ì¹¨ë²”í•  ìˆ˜ ì—†ë‹¤.
- **íš¨ìœ¨ì„±**: ìì£¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ëŠ” ë””ìŠ¤í¬ë¡œ ë‚´ë³´ë‚¸ë‹¤ (swap).
- **í° ì£¼ì†Œ ê³µê°„**: ë¬¼ë¦¬ ë©”ëª¨ë¦¬ë³´ë‹¤ í° ê°€ìƒ ì£¼ì†Œ ê³µê°„ì„ ì œê³µí•œë‹¤.

```mermaid
graph LR
    subgraph í”„ë¡œì„¸ìŠ¤ A
        VA1[ê°€ìƒ ì£¼ì†Œ 0x1000]
    end
    subgraph í”„ë¡œì„¸ìŠ¤ B
        VA2[ê°€ìƒ ì£¼ì†Œ 0x1000]
    end
    subgraph ë¬¼ë¦¬ ë©”ëª¨ë¦¬
        PA1[ë¬¼ë¦¬ ì£¼ì†Œ 0x5000]
        PA2[ë¬¼ë¦¬ ì£¼ì†Œ 0x8000]
    end
    VA1 -->|MMU ë³€í™˜| PA1
    VA2 -->|MMU ë³€í™˜| PA2
```

**ì™œ í˜ì´ì§€ ë‹¨ìœ„ë¡œ ë‚˜ëˆ´ë‚˜?**

ì´ˆê¸°ì—ëŠ” í”„ë¡œê·¸ë¨ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ê±°ë‚˜ ë””ìŠ¤í¬ë¡œ ë‚´ë³´ëƒˆë‹¤ (swapping). í•˜ì§€ë§Œ í”„ë¡œê·¸ë¨ì´ ì»¤ì§€ë©´ì„œ ì´ëŠ” ë¹„íš¨ìœ¨ì ì´ì—ˆë‹¤. **[[virtual-memory#í˜ì´ì§•(Paging)|í˜ì´ì§•(Paging)]]** ë°©ì‹ì€ ë©”ëª¨ë¦¬ë¥¼ ê³ ì • í¬ê¸° (ë³´í†µ 4KB) ë¡œ ë‚˜ëˆ , í•„ìš”í•œ í˜ì´ì§€ë§Œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦°ë‹¤. í”„ë¡œê·¸ë¨ì€ ì½”ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³ , ë°ì´í„°ë„ ì§€ì—­ì„± (locality) ì„ ê°€ì§€ë¯€ë¡œ, ì „ì²´ í”„ë¡œê·¸ë¨ì˜ ì¼ë¶€ë§Œ ë©”ëª¨ë¦¬ì— ìˆì–´ë„ ëŒ€ë¶€ë¶„ì˜ ì‹œê°„ ë™ì•ˆ ì •ìƒ ì‘ë™í•œë‹¤.

#### 3. íŒŒì¼ ì‹œìŠ¤í…œ

ì´ˆê¸° ì»´í“¨í„°ëŠ” í…Œì´í”„ë‚˜ í€ì¹˜ ì¹´ë“œë¥¼ ì‚¬ìš©í–ˆë‹¤. ë°ì´í„°ëŠ” ìˆœì°¨ì ìœ¼ë¡œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆì—ˆë‹¤. ë””ìŠ¤í¬ ë“œë¼ì´ë¸Œê°€ ë“±ì¥í•˜ë©´ì„œ **[[random-access|ëœë¤ ì•¡ì„¸ìŠ¤]]** ê°€ ê°€ëŠ¥í•´ì¡Œê³ , íŒŒì¼ì„ ê³„ì¸µì ìœ¼ë¡œ êµ¬ì¡°í™”í•  í•„ìš”ê°€ ìƒê²¼ë‹¤.

Unix(1970 ë…„ëŒ€) ëŠ” **"ëª¨ë“  ê²ƒì€ íŒŒì¼ì´ë‹¤"** ë¼ëŠ” ì² í•™ì„ ë„ì…í–ˆë‹¤. ì¼ë°˜ íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ ë””ë°”ì´ìŠ¤, í”„ë¡œì„¸ìŠ¤ ì •ë³´ë„ íŒŒì¼ì²˜ëŸ¼ ë‹¤ë£¬ë‹¤. ì´ë¥¼ ìœ„í•´ **VFS(Virtual File System)** ë ˆì´ì–´ë¥¼ ì¶”ê°€í•´, ë‹¤ì–‘í•œ íŒŒì¼ ì‹œìŠ¤í…œ (ext4, XFS, NFS ë“±) ì„ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í–ˆë‹¤.

```mermaid
graph TD
    App[ì• í”Œë¦¬ì¼€ì´ì…˜] -->|read/write| VFS[VFS Layer]
    VFS --> ext4[ext4 íŒŒì¼ì‹œìŠ¤í…œ]
    VFS --> XFS[XFS íŒŒì¼ì‹œìŠ¤í…œ]
    VFS --> NFS[NFS ë„¤íŠ¸ì›Œí¬ íŒŒì¼ì‹œìŠ¤í…œ]
    ext4 --> Disk1[ë¡œì»¬ ë””ìŠ¤í¬]
    XFS --> Disk2[ë¡œì»¬ ë””ìŠ¤í¬]
    NFS --> Network[ë„¤íŠ¸ì›Œí¬]
```

**Inode ì˜ ë“±ì¥ ë°°ê²½**

ì´ˆê¸° íŒŒì¼ ì‹œìŠ¤í…œì€ íŒŒì¼ ì´ë¦„ê³¼ ë°ì´í„°ë¥¼ ì§ì ‘ ì—°ê²°í–ˆë‹¤. í•˜ì§€ë§Œ í•˜ë“œ ë§í¬ (ì—¬ëŸ¬ ì´ë¦„ì´ ê°™ì€ íŒŒì¼ì„ ê°€ë¦¬í‚´) ë¥¼ ì§€ì›í•˜ë ¤ë©´ íŒŒì¼ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ë¶„ë¦¬í•´ì•¼ í–ˆë‹¤. **Inode** ëŠ” íŒŒì¼ì˜ ì‹¤ì œ ë°ì´í„° ìœ„ì¹˜, ê¶Œí•œ, í¬ê¸°, íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ì €ì¥í•˜ê³ , ë””ë ‰í† ë¦¬ëŠ” "íŒŒì¼ ì´ë¦„ â†’ Inode ë²ˆí˜¸" ë§¤í•‘ë§Œ ê´€ë¦¬í•œë‹¤.

#### 4. ì‹œìŠ¤í…œ ì½œ ì¸í„°í˜ì´ìŠ¤

í”„ë¡œê·¸ë¨ì´ í•˜ë“œì›¨ì–´ë¥¼ ì§ì ‘ ì œì–´í•˜ë©´ ìœ„í—˜í•˜ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í”„ë¡œê·¸ë¨ì´ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ë¥¼ ì½ê±°ë‚˜, ë””ìŠ¤í¬ë¥¼ ì„ì˜ë¡œ í¬ë§·í•  ìˆ˜ ìˆë‹¤. **[[cpu-privilege-levels|íŠ¹ê¶Œ ëª¨ë“œ(Privileged Mode)]]**ì™€ **ì‚¬ìš©ì ëª¨ë“œ (User Mode)** ë¶„ë¦¬ê°€ í•„ìš”í–ˆë‹¤.

CPU ëŠ” ë‘ ê°€ì§€ ëª¨ë“œë¥¼ ì§€ì›í•œë‹¤:

- **[[cpu-privilege-levels#Ring 0 (Kernel Mode)|ì»¤ë„ ëª¨ë“œ (Ring 0)]**: ëª¨ë“  ëª…ë ¹ ì‹¤í–‰ ê°€ëŠ¥, í•˜ë“œì›¨ì–´ ì§ì ‘ ì œì–´.
- **[[cpu-privilege-levels#Ring 3 (User Mode)|ì‚¬ìš©ì ëª¨ë“œ (Ring 3)]**: ì œí•œëœ ëª…ë ¹ë§Œ ì‹¤í–‰ ê°€ëŠ¥, ì‹œìŠ¤í…œ ì½œì„ í†µí•´ ì»¤ë„ì— ìš”ì²­.

**ì‹œìŠ¤í…œ ì½œ (System Call)** ì€ ì‚¬ìš©ì í”„ë¡œê·¸ë¨ì´ ì»¤ë„ì—ê²Œ "ì´ ì‘ì—…ì„ ëŒ€ì‹  í•´ì¤˜"ë¼ê³  ìš”ì²­í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŒŒì¼ì„ ì½ìœ¼ë ¤ë©´ `read()` ì‹œìŠ¤í…œ ì½œì„ í˜¸ì¶œí•œë‹¤. ì»¤ë„ì€ ê¶Œí•œì„ í™•ì¸í•˜ê³ , ë””ìŠ¤í¬ ë“œë¼ì´ë²„ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì½ì–´ ëŒë ¤ì¤€ë‹¤.

```mermaid
sequenceDiagram
    participant App as ì‚¬ìš©ì í”„ë¡œê·¸ë¨
    participant Lib as libc
    participant Kernel as ì»¤ë„
    participant HW as í•˜ë“œì›¨ì–´
    
    App->>Lib: fread(file)
    Lib->>Kernel: syscall: read()
    Note over Kernel: ëª¨ë“œ ì „í™˜ (usermode â†’ kernel mode)
    Kernel->>Kernel: ê¶Œí•œ í™•ì¸
    Kernel->>HW: ë””ìŠ¤í¬ ì½ê¸° ëª…ë ¹
    HW-->>Kernel: ë°ì´í„° ë°˜í™˜
    Kernel-->>Lib: ë°ì´í„° ë³µì‚¬
    Note over Kernel: ëª¨ë“œ ì „í™˜ (kernel mode â†’ usermode)
    Lib-->>App: ë°ì´í„° ë°˜í™˜
```

**ì™œ ì‹œìŠ¤í…œ ì½œì€ ëŠë¦°ê°€?**

ëª¨ë“œ ì „í™˜ì—ëŠ” ë¹„ìš©ì´ ë“ ë‹¤. CPU ë ˆì§€ìŠ¤í„°ë¥¼ ì €ì¥í•˜ê³ , í˜ì´ì§€ í…Œì´ë¸”ì„ êµì²´í•˜ê³ , TLB(Translation Lookaside [[buffer|Buffer]]) ë¥¼ ë¹„ì›Œì•¼ í•œë‹¤. ìºì‹œ ì¼ê´€ì„±ë„ ì˜í–¥ì„ ë°›ëŠ”ë‹¤. í•˜ì§€ë§Œ ì´ ë¹„ìš©ì€ **ë³´ì•ˆê³¼ ì•ˆì •ì„±**ì„ ìœ„í•œ í•„ìˆ˜ì ì¸ ëŒ€ê°€ë‹¤. vDSO(virtual Dynamic Shared Object) ê°™ì€ ìµœì í™”ë¡œ ì¼ë¶€ ì‹œìŠ¤í…œ ì½œ (ì˜ˆ: `gettimeofday`) ì€ ëª¨ë“œ ì „í™˜ ì—†ì´ ìœ ì € ê³µê°„ì—ì„œ ì²˜ë¦¬í•œë‹¤.

---

## ì»¤ë„ ì•„í‚¤í…ì²˜ì˜ ì§„í™”

### ëª¨ë†€ë¦¬ì‹ ì»¤ë„ (Monolithic Kernel)

ì´ˆê¸° Unix ì™€ Linux ëŠ” **ëª¨ë†€ë¦¬ì‹** êµ¬ì¡°ë‹¤. íŒŒì¼ ì‹œìŠ¤í…œ, ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ, ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„ê°€ ëª¨ë‘ ì»¤ë„ ê³µê°„ì—ì„œ ì‹¤í–‰ëœë‹¤.

**ì¥ì **:
- ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹ ì´ ë¹ ë¥´ë‹¤ (í•¨ìˆ˜ í˜¸ì¶œë§Œìœ¼ë¡œ ì¶©ë¶„).
- ì„±ëŠ¥ì´ ì¢‹ë‹¤ (ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ìµœì†Œ).

**ë‹¨ì **:
- í•˜ë‚˜ì˜ ë“œë¼ì´ë²„ ë²„ê·¸ê°€ ì „ì²´ ì‹œìŠ¤í…œì„ ë‹¤ìš´ì‹œí‚¬ ìˆ˜ ìˆë‹¤.
- ì»¤ë„ í¬ê¸°ê°€ ì»¤ì§„ë‹¤.

```mermaid
graph TB
    subgraph ëª¨ë†€ë¦¬ì‹ ì»¤ë„
        FS[íŒŒì¼ì‹œìŠ¤í…œ]
        NET[ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ]
        DEV[ë””ë°”ì´ìŠ¤ ë“œë¼ì´ë²„]
        SCHED[ìŠ¤ì¼€ì¤„ëŸ¬]
        MEM[ë©”ëª¨ë¦¬ ê´€ë¦¬]
    end
    App[ì• í”Œë¦¬ì¼€ì´ì…˜] -->|ì‹œìŠ¤í…œ ì½œ| FS
    App -->|ì‹œìŠ¤í…œ ì½œ| NET
    FS -.í•¨ìˆ˜ í˜¸ì¶œ.-> MEM
    NET -.í•¨ìˆ˜ í˜¸ì¶œ.-> SCHED
```

### ë§ˆì´í¬ë¡œ ì»¤ë„ (Microkernel)

1980 ë…„ëŒ€ **Mach**, **L4** ê°™ì€ ë§ˆì´í¬ë¡œ ì»¤ë„ì´ ë“±ì¥í–ˆë‹¤. ì»¤ë„ì€ ìµœì†Œí•œì˜ ê¸°ëŠ¥ (IPC, ìŠ¤ì¼€ì¤„ë§, ê¸°ë³¸ ë©”ëª¨ë¦¬ ê´€ë¦¬) ë§Œ ë‹´ë‹¹í•˜ê³ , íŒŒì¼ ì‹œìŠ¤í…œê³¼ ë“œë¼ì´ë²„ëŠ” ìœ ì € ê³µê°„ í”„ë¡œì„¸ìŠ¤ë¡œ ë¶„ë¦¬í–ˆë‹¤.

**ì¥ì **:
- ì•ˆì •ì„± í–¥ìƒ: ë“œë¼ì´ë²„ í¬ë˜ì‹œê°€ ì»¤ë„ì„ ë©ˆì¶”ì§€ ì•ŠëŠ”ë‹¤.
- ëª¨ë“ˆí™”: ì»´í¬ë„ŒíŠ¸ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì¬ì‹œì‘ ê°€ëŠ¥.

**ë‹¨ì **:
- ì„±ëŠ¥ ì €í•˜: ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹ ì— ë©”ì‹œì§€ íŒ¨ì‹± í•„ìš”, IPC ì˜¤ë²„í—¤ë“œ.
- ë³µì¡ì„± ì¦ê°€: ì‹œìŠ¤í…œ ì„¤ê³„ê°€ ì–´ë µë‹¤.

```mermaid
graph TB
    subgraph ìœ ì € ê³µê°„
        FS_Server[íŒŒì¼ì‹œìŠ¤í…œ ì„œë²„]
        NET_Server[ë„¤íŠ¸ì›Œí¬ ì„œë²„]
        DEV_Server[ë””ë°”ì´ìŠ¤ ì„œë²„]
    end
    subgraph ë§ˆì´í¬ë¡œ ì»¤ë„
        IPC[IPC ë©”ì»¤ë‹ˆì¦˜]
        SCHED[ìŠ¤ì¼€ì¤„ëŸ¬]
        MEM[ë©”ëª¨ë¦¬ ê´€ë¦¬]
    end
    App[ì• í”Œë¦¬ì¼€ì´ì…˜] -->|IPC ë©”ì‹œì§€| FS_Server
    FS_Server -->|IPC| IPC
    IPC --> DEV_Server
```

**ì™œ ëª¨ë†€ë¦¬ì‹ì´ ì—¬ì „íˆ ì£¼ë¥˜ì¸ê°€?**

ì„±ëŠ¥ ì°¨ì´ê°€ ê²°ì •ì ì´ì—ˆë‹¤. 1990 ë…„ëŒ€ ì—°êµ¬ ([Engler et al.](https://pdos.csail.mit.edu/6.828/2008/readings/exokernel.pdf)) ì— ë”°ë¥´ë©´, ë§ˆì´í¬ë¡œ ì»¤ë„ì˜ IPC ì˜¤ë²„í—¤ë“œëŠ” ëª¨ë†€ë¦¬ì‹ ëŒ€ë¹„ 3~5 ë°° ë†’ì•˜ë‹¤. Linux ê°™ì€ ëª¨ë†€ë¦¬ì‹ ì»¤ë„ì€ ë™ì  ëª¨ë“ˆë¡œ ì¼ë¶€ ì´ì  (ëª¨ë“ˆ ë¡œë“œ/ì–¸ë¡œë“œ) ì„ ì œê³µí•˜ë©´ì„œë„ ì„±ëŠ¥ì„ ìœ ì§€í–ˆë‹¤.

### í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼

**Windows NT**ì™€ **macOS(XNU)** ëŠ” í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ì´ë‹¤. ê¸°ë³¸ì€ ëª¨ë†€ë¦¬ì‹ì´ì§€ë§Œ, ì¼ë¶€ ì»´í¬ë„ŒíŠ¸ëŠ” ìœ ì € ê³µê°„ìœ¼ë¡œ ë¶„ë¦¬í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Windows ì˜ User32(ìœˆë„ìš° ë§¤ë‹ˆì €) ëŠ” ì»¤ë„ ëª¨ë“œì˜€ë‹¤ê°€ Vista ì´í›„ ìœ ì € ëª¨ë“œë¡œ ì´ë™í–ˆë‹¤ (ì•ˆì •ì„± í–¥ìƒ).

---

## ì£¼ìš” ì»¤ë„ ì„œë¸Œì‹œìŠ¤í…œê³¼ ì„¤ê³„ ê²°ì •

### 1. í”„ë¡œì„¸ìŠ¤ vs ìŠ¤ë ˆë“œ

ì´ˆê¸° Unix ëŠ” **í”„ë¡œì„¸ìŠ¤**ë§Œ ì§€ì›í–ˆë‹¤. ê° í”„ë¡œì„¸ìŠ¤ëŠ” ë…ë¦½ëœ ë©”ëª¨ë¦¬ ê³µê°„ì„ ê°€ì¡Œë‹¤. í•˜ì§€ë§Œ 1980 ë…„ëŒ€ ë©€í‹°ì½”ì–´ CPU ì™€ GUI ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ì¥ìœ¼ë¡œ **ê²½ëŸ‰ í”„ë¡œì„¸ìŠ¤ (ìŠ¤ë ˆë“œ)** í•„ìš”ì„±ì´ ì»¤ì¡Œë‹¤.

**ë¬¸ì œ**: í”„ë¡œì„¸ìŠ¤ ìƒì„±ì€ ë¹„ì‹¸ë‹¤. `fork()` ëŠ” ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ë¥¼ ë³µì‚¬í•´ì•¼ í•œë‹¤ (Copy-on-Write ë¡œ ìµœì í™”ë˜ì—ˆì§€ë§Œ).

**í•´ê²°**: **ìŠ¤ë ˆë“œ**ëŠ” ê°™ì€ ì£¼ì†Œ ê³µê°„ì„ ê³µìœ í•˜ë©´ì„œ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. ìƒì„± ë¹„ìš©ì´ ë‚®ê³ , ë°ì´í„° ê³µìœ ê°€ ì‰½ë‹¤.

**Linux ì˜ ì ‘ê·¼**: Linux ëŠ” ìŠ¤ë ˆë“œë¥¼ "ê³µìœ  ë©”ëª¨ë¦¬ë¥¼ ê°€ì§„ í”„ë¡œì„¸ìŠ¤"ë¡œ êµ¬í˜„í•œë‹¤. `clone()` ì‹œìŠ¤í…œ ì½œë¡œ ë©”ëª¨ë¦¬, íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°, ì‹œê·¸ë„ í•¸ë“¤ëŸ¬ ë“±ì„ ì„ íƒì ìœ¼ë¡œ ê³µìœ í•œë‹¤. ì´ëŠ” `pthread` ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ê¸°ë°˜ì´ë‹¤.

### 2. ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬

í•˜ë“œì›¨ì–´ (í‚¤ë³´ë“œ, ë””ìŠ¤í¬, ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ) ê°€ ì‘ì—…ì„ ì™„ë£Œí•˜ë©´ CPU ì— **ì¸í„°ëŸ½íŠ¸**ë¥¼ ê±¸ì–´ ì•Œë¦°ë‹¤. ì´ˆê¸° ì‹œìŠ¤í…œì€ **í´ë§ (Polling)** ë°©ì‹ì´ì—ˆë‹¤: CPU ê°€ ë°˜ë³µì ìœ¼ë¡œ í•˜ë“œì›¨ì–´ ìƒíƒœë¥¼ í™•ì¸í–ˆë‹¤. ì´ëŠ” CPU ë¥¼ ë‚­ë¹„í–ˆë‹¤.

**ì¸í„°ëŸ½íŠ¸ ë°©ì‹**ì€ í•˜ë“œì›¨ì–´ê°€ ëŠ¥ë™ì ìœ¼ë¡œ ì‹ í˜¸ë¥¼ ë³´ë‚¸ë‹¤. CPU ëŠ” ì¦‰ì‹œ í˜„ì¬ ì‘ì—…ì„ ì¤‘ë‹¨í•˜ê³ , ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ì‹¤í–‰í•œë‹¤.

**ë¬¸ì œ**: ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ê°€ ë„ˆë¬´ ì˜¤ë˜ ì‹¤í–‰ë˜ë©´, ë‹¤ë¥¸ ì¸í„°ëŸ½íŠ¸ê°€ ì§€ì—°ë˜ê±°ë‚˜ ëˆ„ë½ë  ìˆ˜ ìˆë‹¤.

**í•´ê²°**: **Top Half / Bottom Half** ë¶„ë¦¬.
- **Top Half**: ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ì˜ í•„ìˆ˜ ë¶€ë¶„ë§Œ ë¹ ë¥´ê²Œ ì‹¤í–‰ (ì˜ˆ: ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ ë²„í¼ì— ë³µì‚¬).
- **Bottom Half**: ë‚˜ë¨¸ì§€ ì²˜ë¦¬ëŠ” ë‚˜ì¤‘ì— ì‹¤í–‰ (softirq, tasklet, workqueue). ë‹¤ë¥¸ ì¸í„°ëŸ½íŠ¸ê°€ í—ˆìš©ëœë‹¤.

```mermaid
graph TD
    HW[í•˜ë“œì›¨ì–´ ì´ë²¤íŠ¸] -->|ì¸í„°ëŸ½íŠ¸ ì‹ í˜¸| CPU
    CPU -->|Top Half| IH[ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬]
    IH -->|ë¹ ë¥¸ ì²˜ë¦¬| ACK[í•˜ë“œì›¨ì–´ì— ACK]
    IH -->|ì‘ì—… ë“±ë¡| BH[Bottom Half Queue]
    BH -->|ë‚˜ì¤‘ì— ì‹¤í–‰| Process[ëŠë¦° ì²˜ë¦¬]
```

### 3. ë™ê¸°í™”ì™€ ë½

ë©€í‹°ì½”ì–´ ì‹œëŒ€ (2000 ë…„ëŒ€~) ì—ëŠ” ì—¬ëŸ¬ CPU ê°€ ë™ì‹œì— ì»¤ë„ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤. **Race Condition**(ê²½ìŸ ìƒíƒœ) ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤: ë‘ CPU ê°€ ë™ì‹œì— ê°™ì€ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ë©´ ë¶ˆì¼ì¹˜ê°€ ìƒê¸´ë‹¤.

**í•´ê²°ì±…**:
- **Spinlock**: ì§§ì€ ì„ê³„ êµ¬ì—­ìš©. ë½ì„ ëª» ì–»ìœ¼ë©´ ê³„ì† ë°˜ë³µí•´ì„œ í™•ì¸ (busy-wait).
- **Mutex**: ê¸´ ì„ê³„ êµ¬ì—­ìš©. ë½ì„ ëª» ì–»ìœ¼ë©´ ìŠ¬ë¦½ (ëŒ€ê¸° íì— ë“¤ì–´ê°).
- **RCU(Read-Copy-Update)**: ì½ê¸°ê°€ ì••ë„ì ìœ¼ë¡œ ë§ì€ ê²½ìš°. ì½ê¸°ëŠ” ë½ ì—†ì´ ì§„í–‰, ì“°ê¸°ëŠ” ë³µì‚¬ë³¸ì„ ë§Œë“¤ì–´ ì—…ë°ì´íŠ¸ í›„ í¬ì¸í„°ë¥¼ ì›ìì ìœ¼ë¡œ êµì²´.

**ì™œ Spinlock ì€ sleep í•˜ë©´ ì•ˆ ë˜ë‚˜?**
Spinlock ì„ ì¡ê³  sleep í•˜ë©´, ë‹¤ë¥¸ CPU ê°€ ê°™ì€ ë½ì„ ê¸°ë‹¤ë¦¬ë©° ë¬´í•œ ë£¨í”„ì— ë¹ ì§ˆ ìˆ˜ ìˆë‹¤. ë˜í•œ ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ëŠ” sleep í•  ìˆ˜ ì—†ë‹¤ (ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë¡œ ìŠ¤ì¼€ì¤„ ì•„ì›ƒë  ìˆ˜ ì—†ìŒ). ë”°ë¼ì„œ ì¸í„°ëŸ½íŠ¸ ì»¨í…ìŠ¤íŠ¸ì—ì„œëŠ” Spinlock ë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

### 4. í˜ì´ì§€ ìºì‹œ

ë””ìŠ¤í¬ëŠ” ë©”ëª¨ë¦¬ë³´ë‹¤ 1000 ë°° ì´ìƒ ëŠë¦¬ë‹¤. ë§¤ë²ˆ ë””ìŠ¤í¬ì—ì„œ ì½ìœ¼ë©´ ì„±ëŠ¥ì´ í˜•í¸ì—†ë‹¤.

**í˜ì´ì§€ ìºì‹œ (Page Cache)** ëŠ” ìµœê·¼ ì½ì€ íŒŒì¼ ë‚´ìš©ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•œë‹¤. ê°™ì€ íŒŒì¼ì„ ë‹¤ì‹œ ì½ìœ¼ë©´ ë””ìŠ¤í¬ ì ‘ê·¼ ì—†ì´ ìºì‹œì—ì„œ ë°˜í™˜í•œë‹¤.

**ì“°ê¸° ìµœì í™”**:

- **Write-back**: ì“°ê¸° ìš”ì²­ì„ ë©”ëª¨ë¦¬ì—ë§Œ ë°˜ì˜í•˜ê³ , ë‚˜ì¤‘ì— ë””ìŠ¤í¬ì— í”ŒëŸ¬ì‹œ. ë¹ ë¥´ì§€ë§Œ, ì‹œìŠ¤í…œ í¬ë˜ì‹œ ì‹œ ë°ì´í„° ì†ì‹¤ ìœ„í—˜.
- **Write-through**: ì¦‰ì‹œ ë””ìŠ¤í¬ì— ì“°ê¸°. ëŠë¦¬ì§€ë§Œ ì•ˆì „.
- **Journaling**: íŒŒì¼ ì‹œìŠ¤í…œ (ext4, XFS) ì€ ë©”íƒ€ë°ì´í„° ë³€ê²½ì„ ì €ë„ì— ë¨¼ì € ê¸°ë¡. í¬ë˜ì‹œ í›„ ë¹ ë¥¸ ë³µêµ¬ ê°€ëŠ¥.

**ì™œ fsync() ê°€ í•„ìš”í•œê°€?**
ë°ì´í„°ë² ì´ìŠ¤ì²˜ëŸ¼ ë°ì´í„° ë¬´ê²°ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°, write-back ìºì‹œëŠ” ìœ„í—˜í•˜ë‹¤. `fsync()` ëŠ” ëª…ì‹œì ìœ¼ë¡œ ë””ìŠ¤í¬ í”ŒëŸ¬ì‹œë¥¼ ìš”ì²­í•œë‹¤. ì„±ëŠ¥ì€ ë–¨ì–´ì§€ì§€ë§Œ, ë°ì´í„° ì•ˆì •ì„±ì„ ë³´ì¥í•œë‹¤.

---

## [[cpu-privilege-levels|ì»¤ë„ ëª¨ë“œ vs ìœ ì € ëª¨ë“œ]]

### ì™œ ë‘ ëª¨ë“œë¡œ ë‚˜ëˆ´ë‚˜?

ì´ˆê¸° ì»´í“¨í„°ëŠ” ëª¨ë“  ì½”ë“œê°€ ê°™ì€ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆë‹¤. í”„ë¡œê·¸ë¨ì˜ ë²„ê·¸ë‚˜ ì•…ì˜ì ì¸ ì½”ë“œê°€ ì „ì²´ ì‹œìŠ¤í…œì„ ë§ì¹  ìˆ˜ ìˆì—ˆë‹¤.

**[[cpu-privilege-levels#Intel x86ì˜ ë³´í˜¸ ë§|ë³´í˜¸ ë§(Protection Ring)]]** ê°œë…ì€ 1970 ë…„ëŒ€ **Multics**ì—ì„œ ë„ì…ë˜ì—ˆë‹¤. Intel x86 ì€ Ring 0~3 ê¹Œì§€ 4 ë‹¨ê³„ë¥¼ ì§€ì›í•˜ì§€ë§Œ, ëŒ€ë¶€ë¶„ OS ëŠ” Ring 0(ì»¤ë„) ê³¼ Ring 3(ìœ ì €) ë§Œ ì‚¬ìš©í•œë‹¤.

ìƒì„¸í•œ ë‚´ìš©ì€ [[cpu-privilege-levels]] ë¬¸ì„œ ì°¸ê³ .

### ëª¨ë“œ ì „í™˜ì˜ ì‹¤ì œ ë¹„ìš©

ì‹œìŠ¤í…œ ì½œ í•˜ë‚˜ì˜ ëŒ€ëµì ì¸ ë¹„ìš©:

- **ì»¨í…ìŠ¤íŠ¸ ì €ì¥**: ìœ ì € ëª¨ë“œ ë ˆì§€ìŠ¤í„°ë¥¼ ì €ì¥.
- **í˜ì´ì§€ í…Œì´ë¸” êµì²´**: ì»¤ë„ ì£¼ì†Œ ê³µê°„ìœ¼ë¡œ ì „í™˜.
- **TLB í”ŒëŸ¬ì‹œ**: ì£¼ì†Œ ë³€í™˜ ìºì‹œ ë¬´íš¨í™” (ì¼ë¶€ëŠ” ë³´ì¡´ ê°€ëŠ¥).
- **ì‹œìŠ¤í…œ ì½œ í•¸ë“¤ëŸ¬ ì‹¤í–‰**: ì‹¤ì œ ì‘ì—….
- **ë³µê·€**: ìœ ì € ëª¨ë“œë¡œ ëŒì•„ê°€ë©° ë ˆì§€ìŠ¤í„° ë³µì›.

ì¸¡ì • ì˜ˆì‹œ: ìµœì‹  CPU ì—ì„œ `getpid()`(ê±°ì˜ ì•„ë¬´ê²ƒë„ ì•ˆ í•˜ëŠ” ì‹œìŠ¤í…œ ì½œ) ì‹¤í–‰ ì‹œê°„ì€ ì•½ 100~200 ë‚˜ë…¸ì´ˆ. ë¡œì»¬ í•¨ìˆ˜ í˜¸ì¶œì€ 1~2 ë‚˜ë…¸ì´ˆ. ì•½ 100 ë°° ì°¨ì´.

### vDSO ë¥¼ í†µí•œ ìµœì í™”

ì¼ë¶€ ì‹œìŠ¤í…œ ì½œì€ ì‹¤ì œë¡œ ì»¤ë„ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ì•ŠëŠ”ë‹¤. ì˜ˆ: `gettimeofday()`, `clock_gettime()`.

**vDSO(virtual Dynamic Shared Object)** ëŠ” ì»¤ë„ì´ ìœ ì € ê³µê°„ì— ë§¤í•‘í•˜ëŠ” ê³µìœ  ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. ì‹œê°„ ì •ë³´ë¥¼ ê³µìœ  ë©”ëª¨ë¦¬ì— ê¸°ë¡í•˜ë©´, ìœ ì € í”„ë¡œê·¸ë¨ì€ ëª¨ë“œ ì „í™˜ ì—†ì´ ì½ì„ ìˆ˜ ìˆë‹¤.

---

## ì»¤ë„ ë³´ì•ˆì˜ ì§„í™”

### 1. ê¶Œí•œ ë¶„ë¦¬: UID ì™€ Capabilities

ì „í†µì ì¸ Unix ëŠ” **root(UID 0)** ê°€ ëª¨ë“  ê¶Œí•œì„ ê°€ì¡Œë‹¤. "ì‹ ì´ëƒ ì•„ë‹ˆëƒ"ì˜ ì´ë¶„ë²•ì´ë‹¤. í•˜ì§€ë§Œ ì›¹ ì„œë²„ê°€ í¬íŠ¸ 80 ì„ ì—´ê¸° ìœ„í•´ root ë¡œ ì‹¤í–‰ë˜ë©´, ì·¨ì•½ì ì´ ìƒê²¼ì„ ë•Œ ê³µê²©ìë„ ëª¨ë“  ê¶Œí•œì„ ì–»ëŠ”ë‹¤.

**POSIX Capabilities**(Linux 2.2+) ëŠ” ê¶Œí•œì„ ì„¸ë¶„í™”í•œë‹¤:
- `CAP_NET_BIND_SERVICE`: 1024 ì´í•˜ í¬íŠ¸ ë°”ì¸ë”©.
- `CAP_SYS_ADMIN`: ì‹œìŠ¤í…œ ê´€ë¦¬ ì‘ì—….
- `CAP_KILL`: ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì— ì‹œê·¸ë„ ì „ì†¡.

ì›¹ ì„œë²„ëŠ” `CAP_NET_BIND_SERVICE` ë§Œ ê°€ì§€ê³  ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤.

### 2. ASLR (Address Space Layout Randomization)

**ë²„í¼ ì˜¤ë²„í”Œë¡œìš° ê³µê²©**ì€ ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ì˜ˆì¸¡í•´ ì•…ì˜ì ì¸ ì½”ë“œë¡œ ì í”„í•œë‹¤. ë§Œì•½ ìŠ¤íƒ, í™, ë¼ì´ë¸ŒëŸ¬ë¦¬ ì£¼ì†Œê°€ í•­ìƒ ê°™ë‹¤ë©´ ê³µê²©ì´ ì‰½ë‹¤.

**ASLR**(2000 ë…„ëŒ€ ë„ì…) ì€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒì„ ëœë¤í™”í•œë‹¤. ê³µê²©ìê°€ ì£¼ì†Œë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ì—†ì–´ ê³µê²©ì´ ì–´ë ¤ì›Œì§„ë‹¤.

**KASLR**(Kernel ASLR) ì€ ì»¤ë„ ìì²´ì˜ ì£¼ì†Œë„ ëœë¤í™”í•œë‹¤.

### 3. [[selinux|SELinux]] / AppArmor (Mandatory Access Control)

ì „í†µì ì¸ ê¶Œí•œì€ **DAC(Discretionary Access Control)**: íŒŒì¼ ì†Œìœ ìê°€ ê¶Œí•œì„ ê²°ì •í•œë‹¤. í•˜ì§€ë§Œ í”„ë¡œì„¸ìŠ¤ê°€ ë£¨íŠ¸ ê¶Œí•œì„ ì–»ìœ¼ë©´ ëª¨ë“  íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

**MAC(Mandatory Access Control)** ì€ ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ì •ì±…ì„ ì„¤ì •í•œë‹¤. [[selinux|SELinux]] ëŠ” ê° í”„ë¡œì„¸ìŠ¤ì™€ íŒŒì¼ì— **ë ˆì´ë¸”**(ë„ë©”ì¸/íƒ€ì…) ì„ ë¶™ì´ê³ , "domain X ê°€ type Y ì— ì–´ë–¤ ì‘ì—…ì„ í•  ìˆ˜ ìˆëŠ”ê°€" ì •ì˜í•œë‹¤.

ì˜ˆ: ì›¹ ì„œë²„ (httpd_t) ëŠ” `/var/www/html`(httpd_sys_content_t) ì€ ì½ì„ ìˆ˜ ìˆì§€ë§Œ, `/etc/shadow`(shadow_t) ëŠ” ì½ì„ ìˆ˜ ì—†ë‹¤. ë£¨íŠ¸ë¡œ ì‹¤í–‰ë˜ì–´ë„ ì •ì±…ì´ ì°¨ë‹¨í•œë‹¤.

---

## ë„¤íŠ¸ì›Œí‚¹ ìŠ¤íƒ

### ê³„ì¸µ êµ¬ì¡°ì˜ ì´ìœ 

ì´ˆê¸° ë„¤íŠ¸ì›Œí¬ëŠ” íŠ¹ì • í•˜ë“œì›¨ì–´ì— ì¢…ì†ì ì´ì—ˆë‹¤. 1970 ë…„ëŒ€ **OSI 7 ê³„ì¸µ ëª¨ë¸**ê³¼ **TCP/IP ëª¨ë¸**ì´ ë“±ì¥í•˜ë©´ì„œ í‘œì¤€í™”ë˜ì—ˆë‹¤.

ì»¤ë„ì˜ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒë„ ê³„ì¸µí™”ë˜ì–´ ìˆë‹¤:

1. **L2(ë§í¬ ê³„ì¸µ)**: Ethernet í”„ë ˆì„ ì²˜ë¦¬, MAC ì£¼ì†Œ.
2. **L3(ë„¤íŠ¸ì›Œí¬ ê³„ì¸µ)**: IP ë¼ìš°íŒ…, TTL, ë‹¨í¸í™”.
3. **L4(ì „ì†¡ ê³„ì¸µ)**: TCP(ì—°ê²° ì§€í–¥, ì‹ ë¢°ì„±) / UDP(ë¹„ì—°ê²°, ë¹ ë¦„).

```mermaid
graph TB
    App[ì• í”Œë¦¬ì¼€ì´ì…˜] -->|Socket API| L4
    subgraph ì»¤ë„
        L4[TCP/UDP] --> L3[IP ê³„ì¸µ]
        L3 --> L2[Ethernet ê³„ì¸µ]
        L2 --> Driver[ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„]
    end
    Driver --> NIC[ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ]
```

**ì™œ ì´ë ‡ê²Œ ë‚˜ëˆ´ë‚˜?**
ê³„ì¸µí™”ëŠ” **ëª¨ë“ˆì„±**ì„ ì œê³µí•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Ethernet ì´ë“  Wi-Fi ë“  ìƒê´€ì—†ì´ ê°™ì€ Socket API ë¥¼ ì“´ë‹¤. ì»¤ë„ì´ í•˜ìœ„ ê³„ì¸µì˜ ì°¨ì´ë¥¼ í¡ìˆ˜í•œë‹¤.

### Socket [[buffer|Buffer]] (skb)

íŒ¨í‚·ì´ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ í†µê³¼í•  ë•Œë§ˆë‹¤ ë³µì‚¬í•˜ë©´ ë¹„íš¨ìœ¨ì ì´ë‹¤. **sk_buff** êµ¬ì¡°ì²´ëŠ” íŒ¨í‚· ë°ì´í„°ì˜ í¬ì¸í„°ë§Œ ê°€ì§€ê³ , ê° ê³„ì¸µì€ í—¤ë”ë¥¼ ì¶”ê°€/ì œê±°í•œë‹¤ (zero-copy).

### ğŸš€ Deep Dive: eBPF & XDP (ì»¤ë„ì˜ í˜ëª…)

"ì»¤ë„ì„ ë‹¤ì‹œ ì»´íŒŒì¼í•˜ì§€ ì•Šê³ ë„ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ê³ ?"

#### 1. eBPF (extended Berkeley Packet Filter)

eBPF ëŠ” **"ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ì•ˆì—ì„œ ëŒì•„ê°€ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„"** ì— ë¹„ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ë¬¸ì œì **: ì˜ˆì „ì—ëŠ” ì»¤ë„ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ **ì»¤ë„ ëª¨ë“ˆ (Kernel Module)** ì„ ì§œì•¼ í–ˆìŠµë‹ˆë‹¤ (C ì–¸ì–´). í•˜ì§€ë§Œ ëª¨ë“ˆì— ë²„ê·¸ê°€ ìˆìœ¼ë©´ ì»¤ë„ ì „ì²´ê°€ ë©ˆì¶¥ë‹ˆë‹¤ (Kernel Panic). ìœ„í—˜í•´ì„œ ì•„ë¬´ë‚˜ ëª» í–ˆìŠµë‹ˆë‹¤.
- **í•´ê²°ì±… (Sandbox)**: eBPF ëŠ” **ì‚¬ìš©ìê°€ ì§  í”„ë¡œê·¸ë¨** ì„ ì»¤ë„ ë‚´ ê°€ìƒë¨¸ì‹  (VM) ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤. ë‹¨, ì‹¤í–‰ ì „ì— **Verifier(ê²€ì¦ê¸°)** ê°€ ì½”ë“œë¥¼ ì—„ê²©í•˜ê²Œ ê²€ì‚¬í•©ë‹ˆë‹¤.
    - "ë¬´í•œ ë£¨í”„ê°€ ìˆëŠ”ê°€?" (ìˆìœ¼ë©´ ê±°ì ˆ)
    - "ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ëª¨ë¦¬ë¥¼ ì°¸ì¡°í•˜ëŠ”ê°€?" (ìˆìœ¼ë©´ ê±°ì ˆ)
- **JIT Compiler**: ì•ˆì „í•˜ë‹¤ê³  íŒë‹¨ë˜ë©´, eBPF ë°”ì´íŠ¸ì½”ë“œë¥¼ **ë„¤ì´í‹°ë¸Œ ê¸°ê³„ì–´**ë¡œ ì»´íŒŒì¼í•´ ì»¤ë„ ì†ë„ ê·¸ëŒ€ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤. ì¦‰, ì•ˆì „í•˜ë©´ì„œë„ ëª¨ë“ˆë§Œí¼ ë¹ ë¦…ë‹ˆë‹¤.

#### 2. XDP (eXpress Data Path)

XDP ëŠ” eBPF í”„ë¡œê·¸ë¨ì„ **ë„¤íŠ¸ì›Œí¬ ë“œë¼ì´ë²„ ë ˆë²¨ (ê°€ì¥ ë‚®ì€ ë‹¨ê³„)** ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.

**ì™œ ë“œë¼ì´ë²„ ë ˆë²¨ì´ ì¤‘ìš”í•œê°€? (íŒ¨í‚·ì˜ ì—¬ì •)**
1. **NIC(ëœì¹´ë“œ)** ê°€ íŒ¨í‚· ìˆ˜ì‹ .
2. **Driver**: íŒ¨í‚·ì„ ë©”ëª¨ë¦¬ì— ë³µì‚¬.
3. ğŸ’¥ **XDP Hook**: (ì—¬ê¸°ì„œ XDP í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë¨!)
4. **sk_buff í• ë‹¹**: ë¦¬ëˆ…ìŠ¤ ë„¤íŠ¸ì›Œí‚¹ ìŠ¤íƒì´ ì´í•´í•˜ëŠ” ë¬´ê±°ìš´ êµ¬ì¡°ì²´ (`sk_buff`) ìƒì„±.
5. **Network Stack**: iptables, TCP/IP ì²˜ë¦¬.
6. **Socket**: ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì „ë‹¬.

**XDP ì˜ ë§ˆë²•**:
ë§Œì•½ DDoS ê³µê²© íŒ¨í‚·ì´ë¼ë©´, 4 ë²ˆ `sk_buff` ë¥¼ ë§Œë“¤ê¸° ì „ì— **3 ë²ˆ ë‹¨ê³„ì—ì„œ ë°”ë¡œ ë²„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (`XDP_DROP`).**
ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì´ ë¬´ê±°ìš´ ë„¤íŠ¸ì›Œí‚¹ ìŠ¤íƒì„ ëŒë¦´ í•„ìš”ì¡°ì°¨ ì—†ê²Œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê¸°ì¡´ ëŒ€ë¹„ **10 ë°° ì´ìƒì˜ íŒ¨í‚· ì²˜ë¦¬ ì„±ëŠ¥**ì„ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆì „ì—ëŠ” ë“œë¼ì´ë²„ ì½”ë“œë¥¼ ì§ì ‘ ê³ ì³ì•¼ í–ˆì§€ë§Œ (ë²¤ë” ì¢…ì†ì , ìœ„í—˜í•¨), ì´ì œëŠ” XDP ë¥¼ í†µí•´ í‘œì¤€í™”ëœ ë°©ì‹ìœ¼ë¡œ ë“œë¼ì´ë²„ ë‹¨ê³„ì— ê°œì…í•  ìˆ˜ ìˆê²Œ ëœ ê²ƒì…ë‹ˆë‹¤.

---

## ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 1. CPU ìºì‹œ ì¹œí™”ì„±

í˜„ëŒ€ CPU ëŠ” L1/L2/L3 ìºì‹œë¥¼ ê°€ì§„ë‹¤. ë©”ì¸ ë©”ëª¨ë¦¬ ì ‘ê·¼ì€ ìºì‹œë³´ë‹¤ 100 ë°° ëŠë¦¬ë‹¤. ì»¤ë„ì€ ìì£¼ ì ‘ê·¼í•˜ëŠ” ë°ì´í„°ë¥¼ ê°™ì€ ìºì‹œ ë¼ì¸ì— ë°°ì¹˜í•˜ë ¤ ë…¸ë ¥í•œë‹¤.

**ìŠ¬ë© í• ë‹¹ì (SLAB/SLUB)** ëŠ” ì»¤ë„ì´ ìì£¼ ì“°ëŠ” ê°ì²´ (task_struct, inode) ë¥¼ ë¯¸ë¦¬ í• ë‹¹í•´ë‘¬, ë©”ëª¨ë¦¬ ë‹¨í¸í™”ë¥¼ ì¤„ì´ê³  ìºì‹œ íˆíŠ¸ìœ¨ì„ ë†’ì¸ë‹¤.

### 2. NUMA (Non-Uniform Memory Access)

"ì„œë²„ CPU ëŠ” ì™œ 2 ê°œì¼ê¹Œ? ê·¸ë¦¬ê³  ë‚´ ë©”ëª¨ë¦¬ëŠ” ì™œ ëŠë¦´ê¹Œ?"

#### ğŸ”Œ ì†Œì¼“ (Socket) ì´ë€ ë¬´ì—‡ì¸ê°€?

ì—¬ê¸°ì„œ ë§í•˜ëŠ” **ì†Œì¼“ (Socket)** ì€ ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ (IP:Port) ì´ ì•„ë‹™ë‹ˆë‹¤. **CPU ì¹©ì„ ê½‚ëŠ” ë¬¼ë¦¬ì ì¸ êµ¬ë© (ë©”ì¸ë³´ë“œ ìŠ¬ë¡¯)** ì„ ë§í•©ë‹ˆë‹¤.

- **ì‹±ê¸€ ì†Œì¼“ (Single Socket)**: ì¼ë°˜ì ì¸ ë…¸íŠ¸ë¶ì´ë‚˜ ë°ìŠ¤í¬íƒ‘. CPU ê°€ 1 ê°œë§Œ ê½‚í˜€ ìˆìŠµë‹ˆë‹¤.
- **ë©€í‹° ì†Œì¼“ (Multi Socket)**: ì„œë²„ê¸‰ ë©”ì¸ë³´ë“œì—ëŠ” CPU ë¥¼ 2 ê°œ, 4 ê°œì”© ê½‚ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - **ì™œ ì—¬ëŸ¬ ê°œë¥¼ ê½‚ë‚˜?**: í•˜ë‚˜ì˜ CPU ì¹©ì— ì½”ì–´ë¥¼ ë¬´í•œì • ëŠ˜ë¦¬ëŠ” ê±´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì–´ë µìŠµë‹ˆë‹¤ (ë°œì—´, í¬ê¸°). ê·¸ë˜ì„œ CPU ì¹© ìì²´ë¥¼ ì—¬ëŸ¬ ê°œ ê½‚ì•„ ì½”ì–´ ìˆ˜ë¥¼ 64 ê°œ, 128 ê°œë¡œ ëŠ˜ë¦¬ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

#### ğŸ¢ NUMA ì˜ ë¬¸ì œì 

ë©€í‹° ì†Œì¼“ ì„œë²„ì—ì„œëŠ” ê° CPU(ì†Œì¼“) ë§ˆë‹¤ ìê¸° ì˜†ì— ë¶™ì–´ ìˆëŠ” **ì „ìš© ë©”ëª¨ë¦¬ (Local Memory)** ê°€ ìˆìŠµë‹ˆë‹¤.

1. **Local Access (ë¹ ë¦„)**: CPU 1 ë²ˆì´ ìê¸° ì˜† ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ë©´ ì•„ì£¼ ë¹ ë¦…ë‹ˆë‹¤.
2. **Remote Access (ëŠë¦¼)**: CPU 1 ë²ˆì´ **CPU 2 ë²ˆ ì˜†ì— ìˆëŠ” ë©”ëª¨ë¦¬**ë¥¼ ì“°ë ¤ë©´, í”„ë¡œì„¸ì„œ ê°„ ì—°ê²° (QPI/UPI ë“±) ì„ ê±´ë„ˆê°€ì•¼ í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì—ì„œ **ì†ë„ê°€ 2~3 ë°° ëŠë ¤ì§‘ë‹ˆë‹¤.**

**ì»¤ë„ì˜ ì—­í• **: ì»¤ë„ì€ "CPU 1 ë²ˆì—ì„œ ë„ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ë¬´ì¡°ê±´ CPU 1 ë²ˆ ë©”ëª¨ë¦¬ë¥¼ ì“°ë„ë¡" ê°•ì œí•©ë‹ˆë‹¤. ì´ë¥¼ `NUMA Affinity` ë¼ê³  í•©ë‹ˆë‹¤. db ì„œë²„ íŠœë‹ ì‹œ ë§¤ìš° ì¤‘ìš”í•œ ê°œë…ì…ë‹ˆë‹¤.

### 3. Tickless Kernel

ì „í†µì ìœ¼ë¡œ ì»¤ë„ì€ ê³ ì • ê°„ê²© (ì˜ˆ: 1ms) ìœ¼ë¡œ íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸ë¥¼ ë°œìƒì‹œì¼°ë‹¤. í•˜ì§€ë§Œ ì‹œìŠ¤í…œì´ ìœ íœ´ ìƒíƒœì¼ ë•Œë„ ì¸í„°ëŸ½íŠ¸ê°€ ë°œìƒí•´ ì „ë ¥ì„ ë‚­ë¹„í–ˆë‹¤.

**Tickless(NO_HZ)** ëª¨ë“œëŠ” í•„ìš”í•  ë•Œë§Œ íƒ€ì´ë¨¸ë¥¼ ì„¤ì •í•œë‹¤. ì ˆì „ íš¨ê³¼ê°€ í¬ë‹¤.

---

## ë””ë²„ê¹…ê³¼ íŠ¸ë ˆì´ì‹±

### printk ì˜ í•œê³„

`printk()` ëŠ” ê°„ë‹¨í•˜ì§€ë§Œ, ì„±ëŠ¥ì— ì˜í–¥ì„ ì£¼ê³ , ì¶œë ¥ì´ ë§ìœ¼ë©´ ë¡œê·¸ê°€ ë°€ë¦°ë‹¤.

### ftrace

**ftrace**ëŠ” í•¨ìˆ˜ í˜¸ì¶œì„ ì¶”ì í•œë‹¤. íŠ¹ì • í•¨ìˆ˜ê°€ ì–¼ë§ˆë‚˜ ìì£¼, ì–¼ë§ˆë‚˜ ì˜¤ë˜ ì‹¤í–‰ë˜ëŠ”ì§€ ì¸¡ì •í•  ìˆ˜ ìˆë‹¤.

```bash
echo function_graph > /sys/kernel/debug/tracing/current_tracer
cat /sys/kernel/debug/tracing/trace
```

### eBPF ê¸°ë°˜ ë„êµ¬

**bpftrace**ëŠ” eBPF ë¥¼ ì‰½ê²Œ ì“¸ ìˆ˜ ìˆëŠ” ê³ ê¸‰ ì–¸ì–´ë¥¼ ì œê³µí•œë‹¤. ì˜ˆ: ì‹œìŠ¤í…œ ì½œ ì§€ì—° ì‹œê°„ íˆìŠ¤í† ê·¸ë¨.

```bash
bpftrace -e 'tracepoint:syscalls:sys_enter_read { @start[tid] = nsecs; }
             tracepoint:syscalls:sys_exit_read /@start[tid]/ { 
               @ns = hist(nsecs - @start[tid]); 
             }'
```

---

## ì»¤ë„ ê°œë°œ ì‹¤ìŠµ

### ê°„ë‹¨í•œ ì»¤ë„ ëª¨ë“ˆ

```c
// hello_kernel.c
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/init.h>

static int __init hello_init(void) {
    pr_info("Hello, Kernel World!\n");
    return 0;
}

static void __exit hello_exit(void) {
    pr_info("Goodbye, Kernel World!\n");
}

module_init(hello_init);
module_exit(hello_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("A simple kernel module");
```

```makefile
obj-m += hello_kernel.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
```

```bash
make
sudo insmod hello_kernel.ko
dmesg | tail
sudo rmmod hello_kernel
dmesg | tail
```

---

## ì£¼ìš” ì»¤ë„ ë²„ì „ê³¼ ë³€í™”

- **Linux 0.01 (1991)**: Linus Torvalds ê°€ ê³µê°œ. ë‹¨ìˆœí•œ ëª¨ë†€ë¦¬ì‹ ì»¤ë„.
- **Linux 2.0 (1996)**: SMP(ëŒ€ì¹­í˜• ë©€í‹°í”„ë¡œì„¸ì‹±) ì§€ì›.
- **Linux 2.6 (2003)**: O(1) ìŠ¤ì¼€ì¤„ëŸ¬, í–¥ìƒëœ ìŠ¤ë ˆë“œ ì§€ì›.
- **Linux 3.0 (2011)**: ë²„ì „ ë²ˆí˜¸ ë³€ê²½ (ê¸°ìˆ ì  ë³€í™”ë³´ë‹¤ëŠ” ì‹¬ë³¼).
- **Linux 4.0 (2015)**: Live kernel patching.
- **Linux 5.0 (2019)**: Energy-aware scheduling.
- **Linux 6.0 (2022)**: Rust ì§€ì› ì‹œì‘.

---

## í•™ìŠµ ë¦¬ì†ŒìŠ¤

**ì±…**:
- *Linux Kernel Development* (Robert Love): ì…ë¬¸ììš©.
- *Understanding the Linux Kernel* (Bovet, Cesati): ì‹¬í™”.
- *Operating System Concepts* (Silberschatz): ì´ë¡ .

**ì˜¨ë¼ì¸**:
- [kernel.org](https://www.kernel.org/): ê³µì‹ ë¦¬ëˆ…ìŠ¤ ì»¤ë„ ì†ŒìŠ¤.
- [LWN.net](https://lwn.net/): ì»¤ë„ ê°œë°œ ë‰´ìŠ¤.
- [Linux Kernel Labs](https://linux-kernel-labs.github.io/): ì‹¤ìŠµ.

---

## ì—°ê²° ë¬¸ì„œ

[[android-kernel]] - ì•ˆë“œë¡œì´ë“œ íŠ¹í™” ì»¤ë„ ìˆ˜ì • ì‚¬í•­
