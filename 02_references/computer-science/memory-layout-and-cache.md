---
title: Memory Layout & Cache Fundamentals
tags: [computer-science, hardware, memory, cache, stack, heap, locality]
aliases: [ë©”ëª¨ë¦¬ ê³„ì¸µ êµ¬ì¡°, ìºì‹œ ì§€ì—­ì„±, ìŠ¤íƒê³¼ í™, Memory Hierarchy, Cache Locality]
date created: 2025-12-19 15:21:00 +09:00
date modified: 2025-12-19 15:21:00 +09:00
---

# Memory Layout & Cache Fundamentals

ì†Œí”„íŠ¸ì›¨ì–´ ì„±ëŠ¥ì˜ ìƒí•œì„ ì€ ê²°êµ­ í•˜ë“œì›¨ì–´ê°€ ê²°ì •í•©ë‹ˆë‹¤. ì•Œê³ ë¦¬ì¦˜ì˜ ì‹œê°„ ë³µì¡ë„($O$)ê°€ ì‹¤ì œ ì‹¤í–‰ ì†ë„ë¡œ ë³€í™˜ë˜ëŠ” ê³¼ì •ì—ì„œ ê°€ì¥ ê²°ì •ì ì¸ ì—­í• ì„ í•˜ëŠ” í•˜ë“œì›¨ì–´ ìš”ì†Œì¸ **ë©”ëª¨ë¦¬ ê³„ì¸µ êµ¬ì¡°**ì™€ **ìºì‹œ ì§€ì—­ì„±**ì„ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ë©”ëª¨ë¦¬ ê³„ì¸µ êµ¬ì¡° (Memory Hierarchy)

í˜„ëŒ€ ì»´í“¨í„°ëŠ” 'ì†ë„, ìš©ëŸ‰, ê°€ê²©' ì‚¬ì´ì˜ íš¨ìœ¨ì ì¸ ê· í˜•ì„ ìœ„í•´ í”¼ë¼ë¯¸ë“œ í˜•íƒœì˜ ê³„ì¸µ êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤.

```mermaid
graph TD
    A["<b>Registers</b><br/>(< 1ns, ëª‡ì‹­ Bytes)"] --- B["<b>L1 Cache</b><br/>(~1ns, ëª‡ì‹­ KB)"]
    B --- C["<b>L2 Cache</b><br/>(~4ns, ëª‡ë°± KB)"]
    C --- D["<b>L3 Cache</b><br/>(~10-20ns, ëª‡ MB)"]
    D --- E["<b>Main Memory (RAM)</b><br/>(~100ns, ëª‡ GB)"]
    E --- F["<b>Storage (SSD/HDD)</b><br/>(ms ë‹¨ìœ„, ëª‡ TB)"]

    style A fill:#f96,stroke:#333
    style B fill:#fb8,stroke:#333
    style C fill:#fd8,stroke:#333
    style D fill:#ff8,stroke:#333
    style E fill:#fff,stroke:#333
    style F fill:#eee,stroke:#333
```

- **ìƒìœ„ ê³„ì¸µ**: CPU ì½”ì–´ ê°€ê¹ê³  ë§¤ìš° ë¹ ë¦„ (Volatile, ê³ ê°€).
- **í•˜ìœ„ ê³„ì¸µ**: ìš©ëŸ‰ì´ í¬ê³  ì €ë ´í•¨ (Non-volatile, ì €ì†).
- **ì„±ëŠ¥ ë³‘ëª©**: CPU ì—°ì‚° ì†ë„ì— ë¹„í•´ RAM ì ‘ê·¼ ì†ë„ê°€ í˜„ì €íˆ ëŠë ¤ì§€ëŠ” í˜„ìƒì„ **Memory Wall**ì´ë¼ ë¶€ë¥´ë©°, ì´ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ìºì‹œ(Cache)ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

---

## ğŸ¯ ìºì‹œ ì§€ì—­ì„± (Cache Locality)

ìºì‹œëŠ” CPU ê°€ ë‹¤ìŒì— í•„ìš”ë¡œ í•  ë°ì´í„°ë¥¼ ì˜ˆì¸¡í•˜ì—¬ RAM ì—ì„œ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ëŠ” ì¥ì¹˜ì…ë‹ˆë‹¤. ì´ ì˜ˆì¸¡ì˜ ê·¼ê±°ê°€ ë°”ë¡œ **ì§€ì—­ì„±(Locality)** ì›ë¦¬ì…ë‹ˆë‹¤.

### 1. ì‹œê°„ ì§€ì—­ì„± (Temporal Locality)
ìµœê·¼ì— ì ‘ê·¼í•œ ë°ì´í„°ì— ë‹¤ì‹œ ì ‘ê·¼í•  í™•ë¥ ì´ ë†’ë‹¤ëŠ” ì›ë¦¬ì…ë‹ˆë‹¤.
- **ì˜ˆì‹œ**: ë£¨í”„ë¬¸ì˜ ì¹´ìš´í„° ë³€ìˆ˜(`i`), ìì£¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜.

### 2. ê³µê°„ ì§€ì—­ì„± (Spatial Locality)
ë°©ê¸ˆ ì ‘ê·¼í•œ ë°ì´í„°ì˜ ì¸ì ‘í•œ ë°ì´í„°ì— ì ‘ê·¼í•  í™•ë¥ ì´ ë†’ë‹¤ëŠ” ì›ë¦¬ì…ë‹ˆë‹¤.
- **ì˜ˆì‹œ**: ë°°ì—´ ìˆœíšŒ. CPU ëŠ” í•œ ë°”ì´íŠ¸ë¥¼ ì½ì„ ë•Œ ì¸ì ‘í•œ ë°ì´í„°ë¥¼ í¬í•¨í•œ **Cache Line (ë³´í†µ 64ë°”ì´íŠ¸)** ë‹¨ìœ„ë¡œ ë­‰í……ì´ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

```mermaid
graph LR
    subgraph CacheLine ["Cache Line (64 Bytes)"]
        direction LR
        D1["Data 1"] --- D2["Data 2"] --- D3["Data 3"] --- D4["Data 4"] --- D5["Data 5"] --- D6["Data 6"] --- DN["..."]
    end
```
^ (CPUê°€ Data 1ì„ ìš”ì²­í•˜ë©´, ì¸ì ‘í•œ ë°ì´í„°ë“¤ì´ ìºì‹œ ë¼ì¸ ë‹¨ìœ„ë¡œ í•¨ê»˜ ì ì¬ë¨)

> [!TIP] **False Sharing (ê±°ì§“ ê³µìœ )**
> ë©€í‹°ì½”ì–´ í™˜ê²½ì—ì„œ ì„œë¡œ ë‹¤ë¥¸ ì½”ì–´ê°€ ê°™ì€ ìºì‹œ ë¼ì¸ ë‚´ì˜ ì„œë¡œ ë‹¤ë¥¸ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë ¤ê³  í•  ë•Œ, ìºì‹œ ì¼ê´€ì„±(Coherency)ì„ ìœ ì§€í•˜ê¸° ìœ„í•´ ë¶ˆí•„ìš”í•˜ê²Œ ìºì‹œë¥¼ ë¹„ìš°ê³  ë‹¤ì‹œ ì±„ìš°ëŠ” ì˜¤ë²„í—¤ë“œê°€ ë°œìƒí•˜ëŠ” í˜„ìƒì…ë‹ˆë‹¤.

---

## ğŸ§  í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ (Process Memory Layout)

í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë  ë•Œ ìš´ì˜ì²´ì œë¡œë¶€í„° í• ë‹¹ë°›ëŠ” ê°€ìƒ ë©”ëª¨ë¦¬ ê³µê°„ì˜ êµ¬ì¡°ì…ë‹ˆë‹¤.

```mermaid
block-beta
    columns 1
    Stack["Stack (ì§€ì—­ë³€ìˆ˜, ë§¤ê°œë³€ìˆ˜)"]
    space
    Free["Free Space (Memory Mapping)"]
    space
    Heap["Heap (ë™ì  í• ë‹¹)"]
    Data["Data/BSS (ì „ì—­/ì •ì  ë³€ìˆ˜)"]
    Text["Text (Code)"]

    Stack -- "Growth â†“" --> Free
    Heap -- "Growth â†‘" --> Free

    style Stack fill:#e1f5fe,stroke:#01579b
    style Heap fill:#fff9c4,stroke:#fbc02d
    style Data fill:#f5f5f5,stroke:#9e9e9e
    style Text fill:#f5f5f5,stroke:#9e9e9e
```

| ì˜ì—­ | ì„¤ëª… | ê´€ë¦¬ ì£¼ì²´ |
| :--- | :--- | :--- |
| **Stack** | í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ìƒì„±ë˜ëŠ” ì§€ì—­ ë³€ìˆ˜, ë³µê·€ ì£¼ì†Œ ì €ì¥. LIFO êµ¬ì¡°. | ì»´íŒŒì¼ëŸ¬/ëŸ°íƒ€ì„ ìë™ ê´€ë¦¬ |
| **Heap** | ëŸ°íƒ€ì„ì— í¬ê¸°ê°€ ê²°ì •ë˜ëŠ” ë™ì  ë°ì´í„° ì €ì¥. | ê°œë°œì (ë˜ëŠ” Garbage Collector) |
| **Data/BSS** | í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ í• ë‹¹ë˜ì–´ ì¢…ë£Œ ì‹œê¹Œì§€ ìœ ì§€ë˜ëŠ” ì „ì—­/ì •ì  ë³€ìˆ˜. | ì‹œìŠ¤í…œ |
| **Text** | ì»´íŒŒì¼ëœ ê¸°ê³„ì–´ ì½”ë“œê°€ ì €ì¥ë˜ëŠ” ì½ê¸° ì „ìš© ì˜ì—­. | ì‹œìŠ¤í…œ |

---

## ğŸš¨ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„ ì‹œ ê³ ë ¤ì‚¬í•­

### 1. Array vs Linked List
- **Array**: ë¬¼ë¦¬ì ìœ¼ë¡œ ì—°ì†ë˜ì–´ ìˆì–´ **ê³µê°„ ì§€ì—­ì„±**ì´ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤. í˜„ëŒ€ CPU ì—ì„œ ì••ë„ì ìœ¼ë¡œ ìœ ë¦¬í•©ë‹ˆë‹¤.
- **Linked List**: ë…¸ë“œê°€ ë©”ëª¨ë¦¬ ì—¬ê¸°ì €ê¸° í©ì–´ì ¸ ìˆì–´ ì ‘ê·¼í•  ë•Œë§ˆë‹¤ **Cache Miss**ê°€ ë°œìƒí•  í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.

### 2. ë‹¤ì°¨ì› ë°°ì—´ ì ‘ê·¼ (Row Major vs Column Major)
ê³ ì°¨ì› ë°°ì—´ì€ ë©”ëª¨ë¦¬ì— ì¼ë ¬ë¡œ í¼ì³ì§‘ë‹ˆë‹¤. C-family ì–¸ì–´ëŠ” í–‰ ì¤‘ì‹¬(Row Major)ì´ë¯€ë¡œ ì•ˆìª½ ë£¨í”„ê°€ í–‰ì˜ ì¸ë±ìŠ¤ë¥¼ ë°”ê¿”ì•¼ ì„±ëŠ¥ì´ ì¢‹ìŠµë‹ˆë‹¤.

```python
# GOOD: ê³µê°„ ì§€ì—­ì„± í™œìš© (Row-wise)
for i in range(rows):
    for j in range(cols):
        sum += matrix[i][j] # matrix[i][j]ì™€ matrix[i][j+1]ì€ ì¸ì ‘í•¨

# BAD: ë§¤ë²ˆ ìºì‹œ ë¼ì¸ì„ ìƒˆë¡œ ê°€ì ¸ì™€ì•¼ í•¨ (Column-wise)
for j in range(cols):
    for i in range(rows):
        sum += matrix[i][j] # matrix[i][j]ì™€ matrix[i+1][j]ëŠ” ë§¤ìš° ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆìŒ
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [ë³µì¡ë„ ë¶„ì„](../../01_inbox/algorithm/00_fundamentals/complexity-and-big-o.md): ìºì‹œ íš¨ìœ¨ì´ Big-O ì„±ëŠ¥ì˜ ìƒìˆ˜ë¥¼ ê²°ì •í•˜ëŠ” ì›ë¦¬
- [ì¬ê·€ì™€ í˜¸ì¶œ ìŠ¤íƒ](../../01_inbox/algorithm/00_fundamentals/recursion-and-stack.md): Stack ì˜ì—­ì˜ ë™ì‘ ì›ë¦¬ì™€ ì˜¤ë²„í”Œë¡œìš°
- [Random Access](random-access.md): í•˜ë“œì›¨ì–´ì  ê´€ì ì—ì„œì˜ ì£¼ì†Œ ê¸°ë°˜ ë¬´ì‘ìœ„ ì ‘ê·¼
- [ì„ í˜• ìë£Œêµ¬ì¡°](../../01_inbox/algorithm/01_data-structures/linear.md): Arrayì™€ Linked Listì˜ ìºì‹œ íš¨ìœ¨ì„± ë¹„êµ
