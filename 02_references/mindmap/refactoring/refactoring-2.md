---

mindmap-plugin: basic

---

# 2. 리팩토링 원칙

## 정의
- 통상적 두 가지
   - 명사형
      - 겉보기 동작을 그대로 유지한 채,<br>코드를 이해하고 수정하기 쉽도록 내부 구조를 바꾸는 것
   - 동사형
      - 겉보기 동작을 그대로 유지한 채,<br/>여러가지 리팩토링 기법을 적용해서 소프트웨어를 재구성함
- 여러 작은 단계로 나눠서 실행하는 기법<br/>(컴파일-테스트-커밋)

## 기법
- Inline variable
- Slide statement
- Extract function
- Split phase
- etc.

## 두 개의 모자
- 기능 추가
   - 새 코드 추가만 신경 씀
- 리팩토링
   - 기능 추가는 절대 하지 않고<br/>코드만 재구성함

## 하는 이유?
- 소프트웨어 설계가 좋아진다
   - 리팩토링 하지 않으면 아키텍처가 무너지기 쉽다
   - 아키텍처를 충분히 이해하지 못한 채 코드를 수정하다보면<br/>기반 구조가 무너지기 쉽다(DIP에 의지해야함)
   - 코드만으로 설계를 파악하기 어려워지면<br/>설계를 유지하기 어려워진다
- 소프트웨어를 이해하기 쉬워진다
- 버그를 쉽게 찾을 수 있다
   - 이해하기 쉽다 = 버그를 찾기 쉽다
- 프로그래밍 속도를 높일 수 있다
   - 코드가 명확해 기능을 추가하기 쉽다

## 언제
- 해야하나?
   - (나는) 한시간 간격
      - 3의 법칙
         - 처음에는 그냥 한다
         - 중복이 생기면 일단 계속 진행한다
         - 비슷한 일을 세 번째 하게 되면 리팩토링 한다
   - 기능을 추가하기 직전
      - 준비를 위한 리팩토링
      - 가장 리팩토링하기 좋은 시점
   - 코드를 파악할 때 마다
      - 이해를 위한 리팩토링<br/> - 의도 드러내는데 초점
      - 쓰레기 줍기 리팩토링<br/> - 비효율 처리
   - 기회가 될 때만
      - 간단히 수정할 수 있는 것은 지금,<br/>그렇지 못한 것은 메모해두고 일을 끝내고 처리
- 하지 말아야하나?
   - (나는) 지저분한 코드를 발견해도 굳이 수정할 필요가 없다면 하지 않는다
   - 외부 API 다루듯 호출해서 쓰는 코드라면 지저분해도 그냥 둔다
   - 처음부터 작성하는 것이 쉬울 때 리팩토링 하지 않는다

## 고려할 문제
- 새 기능 개발 속도 저하
   - 리팩토링의 궁극적인 목표:<br/>개발 속도를 높여서, 더 적은 노력으로 더 많은 가치를 창출
   - "클린 코드" 를 위해 집착하지 말 것
- 코드 소유권
   - 코드 소유자가 다른 팀이라 바꿀 권한이 없을 수도 있다
   - 바꾸려는 함수가 고객에게 제공하는 API 라면 함부로 바꿀 수 없다<br/><br/> => 새 함수를 만들고 기존 함수를 호출하도록 만들면 됨
- 브랜치
   - 브랜치 통합을 짧게 가져가는 CI 를 추천
   - CI 를 적용하기 위해서 해야할 일
      - 거대한 기능을 작게 나눠 통합이 잘되도록 해야함
      - 완료되지 않은 기능이 시스템 전체를 망치지 않도록 해야함
- 테스팅
   - 코드의 다양한 측면을 감시하는 다양한 테스트 케이스가 필요
- 레거시 코드
   - 레거시 시스템을 파악할 때 리팩토링이 도움이 된다
   - 하지만 반드시 테스트 코드가 있어야 명료하게 리팩토링 할 수 있다
- 데이터베이스
   - 커다란 변경을 쉽게 조합하고 다룰 수 있는<br/>데이터 마이그레이션 스크립트를 작성해야 함