---
title: apple-cloud-sync-patterns
tags: [apple, cloud, sync, icloud, cloudkit, architecture, offline-first]
aliases: []
date modified: 2025-12-18 01:40:00 +09:00
date created: 2025-12-16 16:09:23 +09:00
---

## Cloud Sync Architecture

"ë¡œì»¬ì—ì„  ì˜ ë˜ëŠ”ë° ì„œë²„ë‘ ë¶™ì´ë‹ˆê¹Œ ê¼¬ì—¬ìš”."
ë™ê¸°í™”(Sync)ëŠ” ì£¼ë‹ˆì–´ì™€ ì‹œë‹ˆì–´ë¥¼ ê°€ë¥´ëŠ” ê°€ì¥ í° ì¥ë²½ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
ë‹¨ìˆœíˆ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ê²Œ ì•„ë‹ˆë¼, **"ì˜¤í”„ë¼ì¸ì¼ ë•Œ ìŒ“ì¸ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ í•  ê²ƒì¸ê°€?"**ë¥¼ ì„¤ê³„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### ğŸ’¡ ì™œ ì´ê²ƒì„ ì•Œì•„ì•¼ í•˜ë‚˜ìš”? (Context)
- **Offline First**: ì‚¬ìš©ìëŠ” í•­ìƒ ì˜¨ë¼ì¸ì´ ì•„ë‹™ë‹ˆë‹¤. ì—˜ë¦¬ë² ì´í„°ì—ì„œ ì“´ ë©”ëª¨ê°€ ì „ì†¡ ì‹¤íŒ¨í–ˆë‹¤ê³  ì‚¬ë¼ì§€ë©´ ì•ˆ ë©ë‹ˆë‹¤. ì¼ë‹¨ ë¡œì»¬ì— ì €ì¥í•˜ê³ , ë‚˜ì¤‘ì— ì¡°ìš©íˆ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤(Outbox Pattern).
- **Conflict Resolution**: ì•„ì´íŒ¨ë“œì—ì„œ "A"ë¼ê³  ìˆ˜ì •í•˜ê³ , ë™ì‹œì— ì•„ì´í°ì—ì„œ "B"ë¼ê³  ìˆ˜ì •í–ˆë‹¤ë©´? ì„œë²„ëŠ” ëˆ„êµ¬ ì†ì„ ë“¤ì–´ì¤˜ì•¼ í• ê¹Œìš”? ì´ ì •ì±…(Last Writer Wins ë“±)ì´ ì—†ìœ¼ë©´ ë°ì´í„°ê°€ ë‚ ì•„ê°‘ë‹ˆë‹¤.
- **Battery**: 1ì´ˆë§ˆë‹¤ ë™ê¸°í™”í•˜ë©´ ë°°í„°ë¦¬ê°€ ë…¹ìŠµë‹ˆë‹¤. ë³€ê²½ ì‚¬í•­ì„ ëª¨ì•„ì„œ(Batch) ë³´ë‚´ê±°ë‚˜, í‘¸ì‹œê°€ ì˜¬ ë•Œë§Œ ë‹¹ê²¨ì˜¤ëŠ” ì „ëµì´ í•„ìš”í•©ë‹ˆë‹¤.

---

### â˜ï¸ CloudKit & Core Data

ì• í”Œ ìƒíƒœê³„ì—ì„œ ë™ê¸°í™”ë¥¼ êµ¬í˜„í•˜ëŠ” ê°€ì¥ í‘œì¤€ì ì¸ ë°©ë²•ì…ë‹ˆë‹¤.

#### 1. NSPersistentCloudKitContainer
Core Dataë¥¼ ì“´ë‹¤ë©´ ì½”ë“œ í•œ ì¤„ ì—†ì´ iCloud ë™ê¸°í™”ê°€ ë©ë‹ˆë‹¤.
- **ì¥ì **: ë¡œì»¬ DB(SQLite)ì™€ í´ë¼ìš°ë“œ ë¯¸ëŸ¬ë§ì„ OSê°€ ì•Œì•„ì„œ í•´ì¤ë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ ë³€ê²½ ì‚¬í•­ë„ ìë™ìœ¼ë¡œ íì— ìŒ“ì˜€ë‹¤ê°€ ì—°ê²°ë˜ë©´ ë‚˜ê°‘ë‹ˆë‹¤.
- **ë‹¨ì **: "ë‚´ ì„œë²„"ê°€ ì•„ë‹™ë‹ˆë‹¤. ì•ˆë“œë¡œì´ë“œë‚˜ ì›¹ì´ë‘ ê³µìœ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤(CloudKit JSê°€ ìˆê¸´ í•˜ì§€ë§Œ).

#### 2. Public vs Private Database
- **Private**: ì‚¬ìš©ì ë³¸ì¸ë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì‚¬ìš©ì iCloud ìš©ëŸ‰ ì°¨ê°)
- **Public**: ëª¨ë“  ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê°œë°œì ìš©ëŸ‰ ì°¨ê°)

---

### ğŸ”„ Sync Patterns (ì„¤ê³„ íŒ¨í„´)

REST APIë¥¼ ì§ì ‘ ì“´ë‹¤ë©´ ì•„ë˜ íŒ¨í„´ì„ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤.

#### 1. Outbox Pattern (ë³´ë‚¼ í¸ì§€í•¨)
ë³€ê²½ ì‚¬í•­ì„ ë°”ë¡œ ë„¤íŠ¸ì›Œí¬ë¡œ ì˜ì§€ ë§ê³ , ë¡œì»¬ í(Outbox)ì— ë¨¼ì € ë„£ìœ¼ì„¸ìš”.
1. UI: ë¡œì»¬ DBì— ì €ì¥í•˜ê³  ì¦‰ì‹œ ë°˜ì˜ (ë‚™ê´€ì  UI).
2. Background: ë„¤íŠ¸ì›Œí¬ ê°ì§€ ì‹œ íì— ìˆëŠ” ìš”ì²­ ì „ì†¡.
3. Fail: ì‹¤íŒ¨í•˜ë©´ ì¬ì‹œë„ íšŸìˆ˜ ì¦ê°€ í›„ ëŒ€ê¸°(Backoff).

#### 2. Delta Sync (ì°¨ë¶„ ë™ê¸°í™”)
"ì „ì²´ ëª©ë¡ ì£¼ì„¸ìš”"ëŠ” ìµœì•…ì…ë‹ˆë‹¤.
- í´ë¼ì´ì–¸íŠ¸: "ë‚˜ 100ë²ˆ ë²„ì „ê¹Œì§€ ìˆì–´. ê·¸ ë’¤ì— ì¼ì–´ë‚œ ì¼ë§Œ ì¤˜." (`since_version=100`)
- ì„œë²„: 101ë²ˆ(ì¶”ê°€), 102ë²ˆ(ì‚­ì œ) ë³€ê²½ ë¡œê·¸ë§Œ ë¦¬í„´.

#### 3. Conflict Resolution (ì¶©ëŒ í•´ê²°)
- **Last Writer Wins (LWW)**: ê°€ì¥ ìµœê·¼ íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ì´ê¹ë‹ˆë‹¤. (êµ¬í˜„ ì‰½ì§€ë§Œ ë°ì´í„° ìœ ì‹¤ ìœ„í—˜)
- **Manual Merge**: ì‚¬ìš©ìì—ê²Œ "ë‘ ë²„ì „ì´ ì¶©ëŒí–ˆìŠµë‹ˆë‹¤" íŒì—…ì„ ë„ì›ë‹ˆë‹¤. (Gitì²˜ëŸ¼)

---

### ğŸ“· Media Sync (ëŒ€ìš©ëŸ‰ íŒŒì¼)

ì‚¬ì§„ì´ë‚˜ ë™ì˜ìƒì€ JSONê³¼ ê°™ì´ ë³´ë‚´ë©´ ì•ˆ ë©ë‹ˆë‹¤.
1. **2-Phase Upload**:
   - 1ë‹¨ê³„: ì„œë²„ì— "ì‚¬ì§„ ì˜¬ë¦´ê²Œ" ìš”ì²­ -> ì„œë²„ê°€ "ì—¬ê¸°ë‹¤ ì˜¬ë ¤(Presigned URL)" ì‘ë‹µ.
   - 2ë‹¨ê³„: URLë¡œ ë°”ì´ë„ˆë¦¬ ì§ì ‘ ì—…ë¡œë“œ.
2. **Resumable**: ì—…ë¡œë“œê°€ 99%ì—ì„œ ëŠê¸°ë©´, ì²˜ìŒë¶€í„°ê°€ ì•„ë‹ˆë¼ 99%ë¶€í„° ë‹¤ì‹œ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤(`Content-Range` í—¤ë” í™œìš©).

### ë” ë³´ê¸°
- [apple-offline-and-resilience](apple-offline-and-resilience.md) - ì˜¤í”„ë¼ì¸ íì™€ íšŒë³µ íƒ„ë ¥ì„± ìƒì„¸
- [apple-coredata-deep-dive](apple-coredata-deep-dive.md) - ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„
